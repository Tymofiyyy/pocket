-- –õ–∞–Ω—Ü—é–∂–æ–∫ –¥–ª—è –¥–µ–ø–æ–∑–∏—Ç—É >= $100
-- –°–ø—Ä–∞—Ü—é—î —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Å—É–º–∞ –¥–µ–ø–æ–∑–∏—Ç—É 100 –∞–±–æ –±—ñ–ª—å—à–µ

-- 1. –°—Ç–≤–æ—Ä—é—î–º–æ –ª–∞–Ω—Ü—é–∂–æ–∫
INSERT INTO message_chains (name, trigger_event, is_active)
VALUES ('–í–µ–ª–∏–∫–∏–π –¥–µ–ø–æ–∑–∏—Ç $100+', 'ftd', true)
RETURNING id;

-- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π ID —â–æ –ø–æ–≤–µ—Ä–Ω—É–≤—Å—è –≤–∏—â–µ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 1)
-- –ê–±–æ –¥–∏–≤–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—ñ: SELECT id FROM message_chains WHERE name = '–í–µ–ª–∏–∫–∏–π –¥–µ–ø–æ–∑–∏—Ç $100+';

-- 2. –ö—Ä–æ–∫ 1: –í—ñ—Ç–∞–Ω–Ω—è –≤—ñ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –¥–µ–ø–æ–∑–∏—Ç—É (–±–µ–∑ —É–º–æ–≤–∏)
INSERT INTO chain_steps (
  chain_id, 
  step_order, 
  delay_hours, 
  message_type, 
  message_text
)
VALUES (
  (SELECT id FROM message_chains WHERE name = '–í–µ–ª–∏–∫–∏–π –¥–µ–ø–æ–∑–∏—Ç $100+'),
  1,
  0,  -- –≤—ñ–¥—Ä–∞–∑—É
  'text',
  'üéâ –í—ñ—Ç–∞—é –∑ –¥–µ–ø–æ–∑–∏—Ç–æ–º!

–í–∞—à –¥–µ–ø–æ–∑–∏—Ç —É—Å–ø—ñ—à–Ω–æ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–∏–π –Ω–∞ —Ä–∞—Ö—É–Ω–æ–∫!

–¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ—á–∞—Ç–∏ —Ç–æ—Ä–≥—É–≤–∞—Ç–∏ —ñ –∑–∞—Ä–æ–±–ª—è—Ç–∏! üí∞'
);

-- 3. –ö—Ä–æ–∫ 2: –°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è —á–µ—Ä–µ–∑ 1 –≥–æ–¥–∏–Ω—É (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –¥–µ–ø–æ–∑–∏—Ç >= 100)
INSERT INTO chain_steps (
  chain_id, 
  step_order, 
  delay_hours, 
  message_type, 
  message_text,
  conditions
)
VALUES (
  (SELECT id FROM message_chains WHERE name = '–í–µ–ª–∏–∫–∏–π –¥–µ–ø–æ–∑–∏—Ç $100+'),
  2,
  1,  -- —á–µ—Ä–µ–∑ 1 –≥–æ–¥–∏–Ω—É
  'text',
  '‚≠êÔ∏è –ï–ö–°–ö–õ–Æ–ó–ò–í–ù–ê –ü–†–û–ü–û–ó–ò–¶–Ü–Ø!

–û—Å–∫—ñ–ª—å–∫–∏ –≤–∏ –∑—Ä–æ–±–∏–ª–∏ –¥–µ–ø–æ–∑–∏—Ç –≤—ñ–¥ $100, –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ:

üéÅ VIP —Å–∏–≥–Ω–∞–ª—ñ–≤
üìä –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ—ó –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏
üíé –ü—ñ–¥–≤–∏—â–µ–Ω–æ–≥–æ –∫–µ—à–±–µ–∫—É 5%
üë®‚Äçüíº –û—Å–æ–±–∏—Å—Ç–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞

–í–∏ —Å–µ—Ä–µ–¥ –Ω–∞—à–∏—Ö –Ω–∞–π–∞–∫—Ç–∏–≤–Ω—ñ—à–∏—Ö —Ç—Ä–µ–π–¥–µ—Ä—ñ–≤! 

–•–æ—á–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ? –ü–∏—à—ñ—Ç—å! üí¨',
  '{"min_deposit": 100}'  -- –£–ú–û–í–ê: –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –¥–µ–ø–æ–∑–∏—Ç 100 USD
);

-- 4. –ö—Ä–æ–∫ 3: –ù–∞–≤—á–∞–ª—å–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ —á–µ—Ä–µ–∑ 24 –≥–æ–¥–∏–Ω–∏ (–¥–ª—è –≤—Å—ñ—Ö)
INSERT INTO chain_steps (
  chain_id, 
  step_order, 
  delay_hours, 
  message_type, 
  message_text
)
VALUES (
  (SELECT id FROM message_chains WHERE name = '–í–µ–ª–∏–∫–∏–π –¥–µ–ø–æ–∑–∏—Ç $100+'),
  3,
  24,  -- —á–µ—Ä–µ–∑ 24 –≥–æ–¥–∏–Ω–∏
  'text',
  'üìö –ö–æ—Ä–∏—Å–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ —Ç—Ä–µ–π–¥–∏–Ω–≥—É:

‚úÖ –Ø–∫ —á–∏—Ç–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫–∏
‚úÖ –°—Ç—Ä–∞—Ç–µ–≥—ñ—ó —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–∏–∑–∏–∫–∞–º–∏
‚úÖ –ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è —Ç—Ä–µ–π–¥–∏–Ω–≥—É
‚úÖ –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –¥–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ–≤

–•–æ—á–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–∞–≤—á–∞–ª—å–Ω—ñ –≤—ñ–¥–µ–æ? –ù–∞–ø–∏—à—ñ—Ç—å –º–µ–Ω—ñ! üéì'
);

-- –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —â–æ —Å—Ç–≤–æ—Ä–∏–ª–æ—Å—å
SELECT 
  mc.id,
  mc.name,
  mc.trigger_event,
  cs.step_order,
  cs.delay_hours,
  LEFT(cs.message_text, 50) as message_preview,
  cs.conditions
FROM message_chains mc
JOIN chain_steps cs ON mc.id = cs.chain_id
WHERE mc.name = '–í–µ–ª–∏–∫–∏–π –¥–µ–ø–æ–∑–∏—Ç $100+'
ORDER BY cs.step_order;

-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:
-- –©–æ–± –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏, –Ω–∞–¥—ñ—à–ª–∏ –ø–æ—Å—Ç–±–µ–∫ –∑ –ø–æ–¥—ñ—î—é FTD —ñ —Å—É–º–æ—é –¥–µ–ø–æ–∑–∏—Ç—É:
-- http://localhost:3000/api/postback?click_id=test123&sub_id1=834685407&event=ftd&trader_id=TR001&sumdep=150

-- –©–æ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è:
-- 1. –ö—Ä–æ–∫ 1 (0 –≥–æ–¥) - –í—Å—ñ –æ—Ç—Ä–∏–º–∞—é—Ç—å –≤—ñ—Ç–∞–Ω–Ω—è
-- 2. –ö—Ä–æ–∫ 2 (1 –≥–æ–¥) - –¢–Ü–õ–¨–ö–ò —è–∫—â–æ sumdep >= 100 - VIP –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è
-- 3. –ö—Ä–æ–∫ 3 (24 –≥–æ–¥) - –í—Å—ñ –æ—Ç—Ä–∏–º–∞—é—Ç—å –Ω–∞–≤—á–∞–ª—å–Ω—ñ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏
